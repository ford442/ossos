<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><title></title></head>
<style>canvas{ display:block; } body, html { padding:0px; margin:0px; width:100%; height:100%; }</style>
<body><script type="module">
// #region IMPORTS
import useThreeWebGL2, { THREE, useDarkScene, useVisualDebug } from '../_lib/useThreeWebGL2.js';

import { Armature, Pose, TranMatrixSkin } from '../../src/index';
import MatrixSkinMaterial           from '../_lib/customSkinning/MatrixSkinMaterial.js';
import Util                         from '../_lib/misc/Util.js';

import GltfUtil, { Gltf2 }          from '../_lib/misc/GltfUtil.js';

import { GLTFLoader }       from '../_thirdparty/GLTFLoader.js';
// #endregion

// #region MAIN
let App = useDarkScene( useThreeWebGL2() );
let Debug;

window.addEventListener( 'load', async _=>{
    // ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    // Setup
    App.sphericalLook( 40, 20, 5 );
    Debug = await useVisualDebug( App );

    // ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    // #region DOWNLOAD FILE
    const url  = '/prototypes/_res/models/Michelle.glb';
    const gltf = await GLTFLoaderAsync( url );
    const grp  = gltf.scene;
    App.scene.add( grp );

    const root = grp.children[0];
    console.log( 'Quat', root.quaternion.toArray(), 'Scale', root.scale.toArray() );
    console.log( 'Root', root );

    console.log( 'Bone', root.children[1] );

    // Reset Offset
    // root.scale.setScalar( 1 );
    // root.quaternion.set( 0, 0, 0, 1 );

    const skin = root.children[0]; // Skinned Mesh
    // skin.scale.setScalar( 0.01 );
    // skin.position.set( 0, 10000, 0 );
    console.log( 'Skin', skin );
    
    const boneView = new THREE.SkeletonHelper( gltf.scene );
    console.log( boneView );
    App.scene.add( boneView );

    console.log( skin.skeleton );

    // Doesn't work correct, because the offset cale strings the distance
    // skin.skeleton.bones[0].position.y += 100;
    // skin.skeleton.bones[0].position.x += 5;
    // skin.skeleton.bones[0].position.z += 5;

    // Works
    // root.position.x += 1;
    
    // #endregion
    
    // ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    App.renderLoop();
});
// #endregion

/** Wrap ThreeJS's GLTFLoader in a promise to use Async/Await functionality */
function GLTFLoaderAsync( url ){
    return new Promise( ( resolve, reject )=>{
        new GLTFLoader().load( url, resolve, null, reject );
    });
}

</script></body></html>