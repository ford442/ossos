<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><title></title></head>
<style>canvas{ display:block; } body, html { padding:0px; margin:0px; width:100%; height:100%; }</style>
<body><script type="module">
//#region IMPORTS
import useThreeWebGL2, { useDarkScene, useVisualDebug } from '../_lib/useThreeWebGL2.js';
import GltfUtil, { Gltf2 }              from '../_lib/misc/GltfUtil.js';
import Util                             from '../_lib/misc/Util.js';

import { Armature, Pose, PoseAnimator } 
    from '../../src/index';
//#endregion

//#region MAIN
let App   = useDarkScene( useThreeWebGL2() );
let Debug = {};
let Ref   = {};

window.addEventListener( 'load', async _=>{
    // ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    // Setup
    App.sphericalLook( 0, 20, 6 );
    Debug = await useVisualDebug( App );

    // ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    // const gltf = await Gltf2.fetch( '/prototypes/_res/anim/mixamo/Walking.gltf' );
    // const gltf = await Gltf2.fetch( '/prototypes/_res/anim/mixamo/Running.gltf' );
    const gltf = await Gltf2.fetch( '/prototypes/_res/anim/mixamo/Catwalk.gltf' );
    const arm  = GltfUtil.parseArmature( gltf, true );
    const clip = GltfUtil.loadAnimationClip( gltf, null, arm.bindPose );

    const animator = new PoseAnimator().setClip( clip ).start();
    animator.usePlacementReset( [0,0,1] ); // This animation uses Z for up.

    // animator.updatePose( arm.poses.opose );
    // arm.poses.opose.updateWorld();
    // Util.debugBones( arm.poses.opose.bones, Debug, 0.08, 1, true );

    Ref.animator = animator;
    Ref.arm      = arm;

    // ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    App.createRenderLoop( onPreRender ).start();
});

function onPreRender( dt, et ){
    const p = Ref.arm.poses.opose;
    Ref.animator
        .step( dt )
        .updatePose( p );

    p.updateWorld();
    Util.debugBones( p.bones, Debug, 0.08, 1, true );
}

//#endregion
</script></body></html>